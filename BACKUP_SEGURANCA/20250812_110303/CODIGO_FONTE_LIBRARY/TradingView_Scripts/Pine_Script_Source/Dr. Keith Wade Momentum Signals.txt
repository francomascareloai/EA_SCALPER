
//@version=5
indicator("Dr. Keith Wade Momentum Signals", overlay=true)

// === 18 EMA ===
emaLength = 18
ema = ta.ema(close, emaLength)
plot(ema, title="EMA 18", color=color.orange)

// === Heikin-Ashi candles ===
haTicker = ticker.heikinashi(syminfo.tickerid)
haOpen = request.security(haTicker, timeframe.period, open)
haClose = request.security(haTicker, timeframe.period, close)
haBullish = haClose > haOpen
haBearish = haClose < haOpen

// === Entry Conditions ===
crossOver = close[2] < ema[2] and close[1] > ema[1] and open > ema
crossUnder = close[2] > ema[2] and close[1] < ema[1] and open < ema

// === Trade State Management ===
var bool inLong = false
var bool inShort = false
var int redCount = 0
var int greenCount = 0

// === Entry Signals ===
buySignal = crossOver and not inLong and not inShort
sellSignal = crossUnder and not inShort and not inLong

// === Update state on entry ===
if buySignal
    inLong := true
    inShort := false
    redCount := 0
    greenCount := 0

if sellSignal
    inShort := true
    inLong := false
    redCount := 0
    greenCount := 0

// === Exit Logic ===
exitLong = false
exitShort = false

if inLong
    if haBearish
        redCount += 1
    else
        redCount := 0
    if redCount >= 2
        exitLong := true
        inLong := false
        redCount := 0

if inShort
    if haBullish
        greenCount += 1
    else
        greenCount := 0
    if greenCount >= 2
        exitShort := true
        inShort := false
        greenCount := 0

// === Plot Buy/Sell/Exit Signals ===
plotshape(buySignal, title="Buy Signal", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)
plotshape(sellSignal, title="Sell Signal", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small)
plotshape(exitLong, title="Exit Long", location=location.abovebar, color=color.orange, style=shape.xcross, size=size.small)
plotshape(exitShort, title="Exit Short", location=location.belowbar, color=color.orange, style=shape.xcross, size=size.small)

// === Alerts ===
alertcondition(buySignal, title="Buy Alert", message="BUY Signal: Price crossed above 18 EMA and confirmed.")
alertcondition(sellSignal, title="Sell Alert", message="SELL Signal: Price crossed below 18 EMA and confirmed.")
alertcondition(exitLong, title="Exit Long Alert", message="EXIT LONG: 2 Red Heikin-Ashi candles detected.")
alertcondition(exitShort, title="Exit Short Alert", message="EXIT SHORT: 2 Green Heikin-Ashi candles detected.")

