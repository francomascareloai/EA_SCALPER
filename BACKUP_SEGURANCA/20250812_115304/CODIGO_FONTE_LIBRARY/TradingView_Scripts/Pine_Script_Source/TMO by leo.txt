//@version=5
indicator("TMO ((T)rue (M)omentum (O)scilator) by leo", shorttitle="TMO by leo", overlay=false)

// Parámetros de entrada
length = input.int(10, title="Length")
calcLength = input.int(5, title="Calculation Length")
smoothLength = input.int(3, title="Smooth Length")

// Inicialización de la variable `data`
var float data = na

// Cálculo del TMO
data := 0.0
for i = 0 to length - 1
    data := data + (close > close[i] ? 1 : close < close[i] ? -1 : 0)

EMA5 = ta.ema(data, calcLength)
Main = ta.ema(EMA5, smoothLength)
Signal = ta.ema(Main, smoothLength)

// Ploteo de las líneas TMO y Signal
plot(Main, color=Main > Signal ? color.green : color.red, title="Main")
plot(Signal, color=Main > Signal ? color.green : color.red, title="Signal")

// Líneas horizontales
hline(0, "Zero", color=color.gray)
hline(math.round(length * .7), "OverBought", color=color.gray)
hline(-math.round(length * .7), "OverSold", color=color.gray)

// Relleno entre las líneas de sobrecompra y sobreventa
fill(plot(math.round(length * .7)), plot(length), color=color.green, transp=70)
fill(plot(-length), plot(-math.round(length * .7)), color=color.red, transp=70)