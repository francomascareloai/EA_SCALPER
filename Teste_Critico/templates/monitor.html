
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Multi-Agente - An√°lise de Metadados</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #fff; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #00ff88; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #888; font-size: 1.1em; }
        
        .controls { background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .btn { background: #00ff88; color: #000; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-right: 10px; }
        .btn:hover { background: #00cc6a; }
        .btn:disabled { background: #555; color: #999; cursor: not-allowed; }
        .btn-danger { background: #ff4444; color: #fff; }
        .btn-danger:hover { background: #cc3333; }
        
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .status-card { background: #2a2a2a; padding: 20px; border-radius: 10px; border-left: 4px solid #00ff88; }
        .status-card h3 { color: #00ff88; margin-bottom: 15px; }
        .status-value { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .status-label { color: #888; font-size: 0.9em; }
        
        .progress-container { background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .progress-bar { width: 100%; height: 20px; background: #444; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00ff88, #00cc6a); transition: width 0.3s ease; }
        .progress-text { text-align: center; margin-top: 10px; font-weight: bold; }
        
        .results-container { background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .results-table { width: 100%; border-collapse: collapse; }
        .results-table th, .results-table td { padding: 12px; text-align: left; border-bottom: 1px solid #444; }
        .results-table th { background: #333; color: #00ff88; }
        .results-table tr:hover { background: #333; }
        
        .chart-container { background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .quality-bar { display: flex; height: 30px; border-radius: 15px; overflow: hidden; margin-top: 10px; }
        .quality-segment { display: flex; align-items: center; justify-content: center; color: #000; font-weight: bold; }
        .excellent { background: #00ff88; }
        .good { background: #ffaa00; }
        .average { background: #ff6600; }
        .poor { background: #ff4444; }
        
        .log-container { background: #1a1a1a; padding: 20px; border-radius: 10px; max-height: 300px; overflow-y: auto; }
        .log-entry { padding: 5px 0; border-bottom: 1px solid #333; font-family: monospace; }
        .log-timestamp { color: #888; }
        .log-message { color: #fff; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .running { animation: pulse 2s infinite; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Monitor Multi-Agente v4.0</h1>
            <p>Sistema de An√°lise de Metadados em Tempo Real</p>
        </div>
        
        <div class="controls">
            <button id="startBtn" class="btn" onclick="startAnalysis()">üöÄ Iniciar An√°lise</button>
            <button id="stopBtn" class="btn btn-danger" onclick="stopAnalysis()" disabled>‚èπÔ∏è Parar</button>
            <button id="exportBtn" class="btn" onclick="exportResults()">üíæ Exportar</button>
            <input type="text" id="directoryInput" placeholder="Diret√≥rio (padr√£o: Input_Expandido)" style="padding: 12px; margin-left: 10px; border-radius: 5px; border: 1px solid #555; background: #333; color: #fff;">
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>üìä Status</h3>
                <div class="status-value" id="statusValue">Idle</div>
                <div class="status-label">Estado do Sistema</div>
            </div>
            <div class="status-card">
                <h3>üìÅ Arquivos</h3>
                <div class="status-value" id="filesValue">0/0</div>
                <div class="status-label">Processados/Total</div>
            </div>
            <div class="status-card">
                <h3>‚≠ê Score M√©dio</h3>
                <div class="status-value" id="scoreValue">0.0</div>
                <div class="status-label">Score Unificado</div>
            </div>
            <div class="status-card">
                <h3>‚úÖ FTMO Ready</h3>
                <div class="status-value" id="ftmoValue">0</div>
                <div class="status-label">Arquivos Aprovados</div>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progressText">Aguardando in√≠cio...</div>
        </div>
        
        <div class="chart-container">
            <h3>üìà Distribui√ß√£o de Qualidade</h3>
            <div class="quality-bar" id="qualityBar">
                <div class="quality-segment excellent" style="flex: 1;">Excelente: 0</div>
                <div class="quality-segment good" style="flex: 1;">Bom: 0</div>
                <div class="quality-segment average" style="flex: 1;">M√©dio: 0</div>
                <div class="quality-segment poor" style="flex: 1;">Ruim: 0</div>
            </div>
        </div>
        
        <div class="results-container">
            <h3>üìã Resultados em Tempo Real</h3>
            <div style="max-height: 400px; overflow-y: auto;">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th>Tipo</th>
                            <th>Estrat√©gia</th>
                            <th>Score</th>
                            <th>FTMO Status</th>
                            <th>Tempo (s)</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <tr><td colspan="6" style="text-align: center; color: #888;">Nenhum resultado ainda...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="log-container">
            <h3>üìù Log do Sistema</h3>
            <div id="logContainer">
                <div class="log-entry">
                    <span class="log-timestamp">[Sistema]</span>
                    <span class="log-message">Monitor iniciado - Aguardando comandos...</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let updateInterval;
        
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message">${message}</span>
            `;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Atualizar status
                    const statusElement = document.getElementById('statusValue');
                    statusElement.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                    statusElement.className = data.status === 'running' ? 'status-value running' : 'status-value';
                    
                    // Atualizar arquivos
                    document.getElementById('filesValue').textContent = `${data.processed_files}/${data.total_files}`;
                    
                    // Atualizar score
                    document.getElementById('scoreValue').textContent = data.metrics.avg_unified_score.toFixed(1);
                    
                    // Atualizar FTMO
                    document.getElementById('ftmoValue').textContent = data.metrics.ftmo_ready_count;
                    
                    // Atualizar progresso
                    const progressFill = document.getElementById('progressFill');
                    const progressText = document.getElementById('progressText');
                    progressFill.style.width = `${data.progress}%`;
                    
                    if (data.status === 'running') {
                        progressText.textContent = `Processando: ${data.current_file} (${data.progress.toFixed(1)}%)`;
                    } else if (data.status === 'completed') {
                        progressText.textContent = `An√°lise conclu√≠da! ${data.processed_files} arquivos processados`;
                    } else {
                        progressText.textContent = 'Aguardando in√≠cio...';
                    }
                    
                    // Atualizar distribui√ß√£o de qualidade
                    updateQualityChart(data.real_time_stats.quality_distribution);
                    
                    // Atualizar tabela de resultados
                    updateResultsTable(data.results);
                    
                    // Atualizar bot√µes
                    const startBtn = document.getElementById('startBtn');
                    const stopBtn = document.getElementById('stopBtn');
                    
                    if (data.status === 'running') {
                        startBtn.disabled = true;
                        stopBtn.disabled = false;
                    } else {
                        startBtn.disabled = false;
                        stopBtn.disabled = true;
                    }
                })
                .catch(error => {
                    console.error('Erro ao atualizar status:', error);
                    addLog(`Erro ao atualizar status: ${error.message}`, 'error');
                });
        }
        
        function updateQualityChart(distribution) {
            const total = Object.values(distribution).reduce((a, b) => a + b, 0);
            if (total === 0) return;
            
            const qualityBar = document.getElementById('qualityBar');
            qualityBar.innerHTML = `
                <div class="quality-segment excellent" style="flex: ${distribution.excellent};">Excelente: ${distribution.excellent}</div>
                <div class="quality-segment good" style="flex: ${distribution.good};">Bom: ${distribution.good}</div>
                <div class="quality-segment average" style="flex: ${distribution.average};">M√©dio: ${distribution.average}</div>
                <div class="quality-segment poor" style="flex: ${distribution.poor};">Ruim: ${distribution.poor}</div>
            `;
        }
        
        function updateResultsTable(results) {
            const tbody = document.getElementById('resultsTableBody');
            
            if (results.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #888;">Nenhum resultado ainda...</td></tr>';
                return;
            }
            
            tbody.innerHTML = results.slice(-10).reverse().map(result => `
                <tr>
                    <td>${result.filename || 'N/A'}</td>
                    <td>${result.file_type || 'N/A'}</td>
                    <td>${result.strategy || 'N/A'}</td>
                    <td>${result.unified_score ? result.unified_score.toFixed(2) : 'N/A'}</td>
                    <td><span style="color: ${result.ftmo_status === 'FTMO_READY' ? '#00ff88' : result.ftmo_status === 'FTMO_POTENTIAL' ? '#ffaa00' : '#ff4444'}">${result.ftmo_status || 'N/A'}</span></td>
                    <td>${result.processing_time ? result.processing_time.toFixed(3) : 'N/A'}</td>
                </tr>
            `).join('');
        }
        
        function startAnalysis() {
            const directory = document.getElementById('directoryInput').value || 'Input_Expandido';
            
            fetch('/api/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ directory: directory })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    addLog(`Erro: ${data.error}`, 'error');
                } else {
                    addLog(`An√°lise iniciada no diret√≥rio: ${data.directory}`, 'success');
                }
            })
            .catch(error => {
                addLog(`Erro ao iniciar an√°lise: ${error.message}`, 'error');
            });
        }
        
        function stopAnalysis() {
            fetch('/api/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    addLog(data.message || data.error, data.error ? 'error' : 'info');
                })
                .catch(error => {
                    addLog(`Erro ao parar an√°lise: ${error.message}`, 'error');
                });
        }
        
        function exportResults() {
            fetch('/api/export', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        addLog(`Erro na exporta√ß√£o: ${data.error}`, 'error');
                    } else {
                        addLog(data.message, 'success');
                    }
                })
                .catch(error => {
                    addLog(`Erro ao exportar: ${error.message}`, 'error');
                });
        }
        
        // Iniciar atualiza√ß√µes autom√°ticas
        updateInterval = setInterval(updateStatus, 1000);
        updateStatus(); // Primeira atualiza√ß√£o
        
        // Adicionar log inicial
        addLog('Interface web carregada - Sistema pronto para uso!');
    </script>
</body>
</html>
    